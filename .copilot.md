# Copilot Project Instructions – Enigma Machine

These instructions guide Copilot to generate **correct, assignment-compliant** code.

## Architecture Requirements
- Use modules: `machine` (core logic), `engine` (operations, validation, history), `loader` (XML parsing), `console` (UI only).
- Exercise 3: add Spring Boot controllers + services.
- No printing or UI logic in machine/engine/loader.
- Engine is passive: does not know the caller.
- Exchange data only through DTOs.
- Do not expose internal machine objects (rotors, reflectors, plugboard).

## Code Style (Java Code Conventions)
- Java 21.
- Naming:
    - Classes: UpperCamelCase
    - Methods/vars: lowerCamelCase
    - Constants: UPPER_SNAKE_CASE
- Keep indentation consistent; avoid long methods and code duplication.
- Prefer immutable models (Alphabet, Mapping, CodeConfiguration).
- Keep class responsibilities narrow; avoid “god objects”.
- Avoid unnecessary static utilities.
- Follow clean imports (remove unused ones).

## XML Loader Rules
- XML is schema-valid but may be application-invalid—must validate:
    - even alphabet length,
    - rotor IDs consecutive 1..N,
    - reflectors with unique Roman IDs,
    - reflector cannot map a letter to itself,
    - Rotor mapping must be bijective (no duplicates in left/right columns).
- Invalid XML → return clear error without overriding previous machine.
- Valid XML → fully override machine and reset history.

## Code Configuration Rules
- Rotor order is right → left.
- Initial position uses the **right** mapping column.
- Manual configuration:
    - rotor ID list (comma-separated),
    - rotor initial positions (string of characters),
    - reflector Roman numeral,
    - (Ex2) plug pairs: even-length string, no repetitions, no self-mapping.
- Automatic configuration: random valid code, returned in compact format.

## Machine Behavior
- Rotors step: rightmost always steps; propagation occurs when notch is at window.
- Processing updates rotor positions (no auto-reset).
- Reset restores original (initial) code configuration.
- Reject characters not in alphabet.

## History & Statistics
- Track: original code, all used codes, all messages, durations (nano), grouped by code.
- Reset history only when a **valid new XML** is loaded.

## Maven (Exercise 2)
- Multi-module Maven with aggregator POM.
- Use assembly plugin to create uber-jar.
- Final artifact name: `enigma-machine-ex2.jar`.

## Spring Boot (Exercise 3)
- Root endpoint: `/enigma`.
- Controllers provide routing only; services contain logic.
- JSON structures must match required format exactly.
- Produce Spring Boot uber-jar: `enigma-machine-server-ex3.jar`.

## Console/UI Rules
- UI prints only and reads from Scanner.
- All numbering for user interaction starts at 1.
- Errors must be clear, readable, and actionable.
- No colors, no clearing console, no fancy output.

## Do Not Generate
- No business logic in UI.
- No printing inside machine, engine, or loader.
- No exposure of internal state objects.
- No hardcoding XML paths.
- No Hebrew in output.

## Class Structure Rules
1. Package statement
2. Imports
3. Class declaration
4. Static constants (if any)
5. Fields 
   -	public
   -	protected
   -	package-private
   -	private final
   -	private non-final
6. Constructors
7. Public methods (follow the interface order)
8. Package-private methods (if needed)
9. Private helper methods (grouped at the bottom)
10. Inner classes / enums (if any)

### Example
```text
/*--------------- Fields ---------------*/
private final Keyboard keyboard;
private Code code;

/*--------------- Constructors ---------------*/
public MachineImpl(Keyboard keyboard) {
    ...
}

/*--------------- Methods ---------------*/
@Override
public char process(char input) {
    ...
}

/*--------------- Helpers ---------------*/
private void advance(List<Rotor> rotors) { ... }

private static int forwardTransform(List<Rotor> rotors, int value) { ... }

private static int backwardTransform(List<Rotor> rotors, int value) { ... }
```

## Additional rules:
- Keep all package names lowercase.
- Class names must be UpperCamelCase.
- Keep private helper methods together at the bottom to avoid cluttering the class.
- Keep spacing and formatting consistent.
- Avoid mixing public and private methods — always group by visibility level.
- Keep classes small, focused, and readable.