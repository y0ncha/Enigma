{
  "info": {
    "_postman_id": "25c74ff9-2476-4fc6-8b0d-ab91b1e1ce2c",
    "name": "Enigma API - Sanity",
    "description": "API for the Enigma project.\n- Base URL: http://localhost:8080\n- No authentication or authorization required\n- All endpoints are prefixed with `/enigma`\n",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "sanity",
      "item": [
        {
          "name": "Sanity load small machine (ex3-sanity-small.xml)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "9183f042-021b-4781-8cd7-f97cff98d812",
                "exec": [
                  "let jsonData = null;",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test(\"Load response is JSON\", function () {",
                  "    jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an(\"object\");",
                  "});",
                  "pm.collectionVariables.set(\"machineNameSanity\", (jsonData && jsonData.name) ? jsonData.name : (pm.collectionVariables.get(\"machineNameSanity\") || \"sanity\"));",
                  "pm.collectionVariables.set(\"activeMachineName\", pm.collectionVariables.get(\"machineNameSanity\"));"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "354e750b-4bcd-4b38-aa9f-ccb6e483220a",
                "exec": [
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "id": "sanity-load-small",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "contentType": "",
                  "src": [
                    "postman-cloud:///1f108e8f-a7e9-42b0-9b83-235b0d554d85"
                  ]
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/load",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "load"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity load paper machine (ex3-sanity-paper-enigma.xml)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "ac232341-4328-44d4-867c-2c84bf17599c",
                "exec": [
                  "let jsonData = null;",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test(\"Load response is JSON\", function () {",
                  "    jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an(\"object\");",
                  "});",
                  "pm.collectionVariables.set(\"machineNamePaper\", (jsonData && jsonData.name) ? jsonData.name : (pm.collectionVariables.get(\"machineNamePaper\") || \"paper-enigma\"));"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "3da6999c-bdce-4ff8-91df-17c5f6275d8d",
                "exec": [
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "id": "sanity-load-paper",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "contentType": "",
                  "src": [
                    "postman-cloud:///1f108e90-3730-4db0-8a8b-77ab43cdd83c"
                  ]
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/load",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "load"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity create session - small",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const machineName = pm.collectionVariables.get(\"machineNameSanity\") || \"sanity\";",
                  "pm.collectionVariables.set(\"machineNameSanity\", machineName);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "const jsonData = pm.response.json();",
                  "pm.test(\"Session response has sessionID\", function () {",
                  "    pm.expect(jsonData.sessionID).to.be.a(\"string\").and.not.empty;",
                  "});",
                  "pm.collectionVariables.set(\"sanitySmallSessionId\", jsonData.sessionID);"
                ]
              }
            }
          ],
          "id": "sanity-create-session-small",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"machine\": \"{{machineNameSanity}}\"\n}",
              "options": {
                "raw": {
                  "headerFamily": "json",
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/session",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "session"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity create session - paper",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const machineName = pm.collectionVariables.get(\"machineNamePaper\") || \"paper-enigma\";",
                  "pm.collectionVariables.set(\"machineNamePaper\", machineName);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "const jsonData = pm.response.json();",
                  "pm.test(\"Session response has sessionID\", function () {",
                  "    pm.expect(jsonData.sessionID).to.be.a(\"string\").and.not.empty;",
                  "});",
                  "pm.collectionVariables.set(\"sanityPaperSessionId\", jsonData.sessionID);"
                ]
              }
            }
          ],
          "id": "sanity-create-session-paper",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"machine\": \"{{machineNamePaper}}\"\n}",
              "options": {
                "raw": {
                  "headerFamily": "json",
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/session",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "session"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity configure small (3,2 @ C,C)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-configure-small",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "text/plain"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sessionID\": \"{{sanitySmallSessionId}}\",\n  \"rotors\": [\n    {\n      \"rotorNumber\": 3,\n      \"rotorPosition\": \"C\"\n    },\n    {\n      \"rotorNumber\": 2,\n      \"rotorPosition\": \"C\"\n    }\n  ],\n  \"reflector\": \"I\",\n  \"plugs\": []\n}",
              "options": {
                "raw": {
                  "headerFamily": "json",
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/config/manual",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "config",
                "manual"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity configure paper (1,2,3 @ O,D,X)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-configure-paper",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "text/plain"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sessionID\": \"{{sanityPaperSessionId}}\",\n  \"rotors\": [\n    {\n      \"rotorNumber\": 1,\n      \"rotorPosition\": \"O\"\n    },\n    {\n      \"rotorNumber\": 2,\n      \"rotorPosition\": \"D\"\n    },\n    {\n      \"rotorNumber\": 3,\n      \"rotorPosition\": \"X\"\n    }\n  ],\n  \"reflector\": \"I\",\n  \"plugs\": []\n}",
              "options": {
                "raw": {
                  "headerFamily": "json",
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/enigma/config/manual",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "config",
                "manual"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity concurrency processing (reset before each input)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const baseUrl = pm.collectionVariables.get(\"baseUrl\");",
                  "const smallSessionId = pm.collectionVariables.get(\"sanitySmallSessionId\") || \"\";",
                  "const paperSessionId = pm.collectionVariables.get(\"sanityPaperSessionId\") || \"\";",
                  "pm.test(\"Both sanity sessions exist\", function () {",
                  "    pm.expect(smallSessionId).to.be.a(\"string\").and.not.empty;",
                  "    pm.expect(paperSessionId).to.be.a(\"string\").and.not.empty;",
                  "});",
                  "const smallCases = [",
                  "    { input: \"AABBCCDDEEFF\" },",
                  "    { input: \"FEDCBADDEF\" },",
                  "    { input: \"FACEBEEF\" },",
                  "    { input: \"AFBFCDFEFFFF\" },",
                  "    { input: \"AAAEEBBBDDDCCCFFF\" }",
                  "];",
                  "const paperCases = [",
                  "    { input: \"THERAINISDROPPING\" },",
                  "    { input: \"HELLOWORLD\" },",
                  "    { input: \"ENIGMAMACHINEROCKS\" },",
                  "    { input: \"WOWCANTBELIEVEITACTUALLYWORKS\" },",
                  "    { input: \"JAVARULES\" }",
                  "];",
                  "pm.test(\"Small-case inputs use sanity-small alphabet (A-F)\", function () {",
                  "    smallCases.forEach(function (c) {",
                  "        pm.expect(/^[A-F]+$/.test(c.input)).to.eql(true);",
                  "    });",
                  "});",
                  "const maxCases = Math.min(smallCases.length, paperCases.length);",
                  "function requestJson(method, url, done) {",
                  "    pm.sendRequest({ method: method, url: url, header: { Accept: \"application/json\" } }, function (err, res) {",
                  "        done(err, res);",
                  "    });",
                  "}",
                  "function requestText(method, url, done) {",
                  "    pm.sendRequest({ method: method, url: url, header: { Accept: \"text/plain\" } }, function (err, res) {",
                  "        done(err, res);",
                  "    });",
                  "}",
                  "function runCase(index) {",
                  "    if (index >= maxCases) {",
                  "        return;",
                  "    }",
                  "    const s = smallCases[index];",
                  "    const p = paperCases[index];",
                  "    requestText(\"PUT\", `${baseUrl}/enigma/config/reset?sessionID=${encodeURIComponent(smallSessionId)}`, function (errResetS, resResetS) {",
                  "        pm.test(`Small reset #${index + 1} status 200`, function () {",
                  "            pm.expect(errResetS).to.eql(null);",
                  "            pm.expect(resResetS.code).to.eql(200);",
                  "        });",
                  "        requestJson(\"POST\", `${baseUrl}/enigma/process?input=${encodeURIComponent(s.input)}&sessionID=${encodeURIComponent(smallSessionId)}`, function (errProcessS, resProcessS) {",
                  "            pm.test(`Small process #${index + 1} status 200`, function () {",
                  "                pm.expect(errProcessS).to.eql(null);",
                  "                pm.expect(resProcessS.code).to.eql(200);",
                  "            });",
                  "            const bodyS = resProcessS.json();",
                  "            pm.test(`Small process #${index + 1} output exists`, function () {",
                  "                pm.expect(bodyS.output).to.be.a(\"string\").and.not.empty;",
                  "                pm.expect(bodyS.output.length).to.eql(s.input.length);",
                  "            });",
                  "            requestText(\"PUT\", `${baseUrl}/enigma/config/reset?sessionID=${encodeURIComponent(paperSessionId)}`, function (errResetP, resResetP) {",
                  "                pm.test(`Paper reset #${index + 1} status 200`, function () {",
                  "                    pm.expect(errResetP).to.eql(null);",
                  "                    pm.expect(resResetP.code).to.eql(200);",
                  "                });",
                  "                requestJson(\"POST\", `${baseUrl}/enigma/process?input=${encodeURIComponent(p.input)}&sessionID=${encodeURIComponent(paperSessionId)}`, function (errProcessP, resProcessP) {",
                  "                    pm.test(`Paper process #${index + 1} status 200`, function () {",
                  "                        pm.expect(errProcessP).to.eql(null);",
                  "                        pm.expect(resProcessP.code).to.eql(200);",
                  "                    });",
                  "                    const bodyP = resProcessP.json();",
                  "                    pm.test(`Paper process #${index + 1} output exists`, function () {",
                  "                        pm.expect(bodyP.output).to.be.a(\"string\").and.not.empty;",
                  "                        pm.expect(bodyP.output.length).to.eql(p.input.length);",
                  "                    });",
                  "                    runCase(index + 1);",
                  "                });",
                  "            });",
                  "        });",
                  "    });",
                  "}",
                  "runCase(0);"
                ]
              }
            }
          ],
          "id": "sanity-concurrency-validation",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/enigma/config?sessionID={{sanitySmallSessionId}}&verbose=false",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "config"
              ],
              "query": [
                {
                  "key": "sessionID",
                  "value": "{{sanitySmallSessionId}}"
                },
                {
                  "key": "verbose",
                  "value": "false"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity history by small session",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-history-small-session",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/enigma/history?sessionID={{sanitySmallSessionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "history"
              ],
              "query": [
                {
                  "key": "sessionID",
                  "value": "{{sanitySmallSessionId}}"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity history by paper session",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-history-paper-session",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/enigma/history?sessionID={{sanityPaperSessionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "history"
              ],
              "query": [
                {
                  "key": "sessionID",
                  "value": "{{sanityPaperSessionId}}"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity history by small machine",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-history-small-machine",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/enigma/history?machineName={{machineNameSanity}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "history"
              ],
              "query": [
                {
                  "key": "machineName",
                  "value": "{{machineNameSanity}}"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Sanity history by paper machine",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "id": "sanity-history-paper-machine",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/enigma/history?machineName={{machineNamePaper}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "enigma",
                "history"
              ],
              "query": [
                {
                  "key": "machineName",
                  "value": "{{machineNamePaper}}"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "id": "folder-sanity-concurrency"
    }
  ],
  "variable": [
    {
      "id": "4ee5e582-ec67-47df-859a-0563842cdf95",
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "id": "f5577921-71c8-4d5c-a75e-7b50739a90a1",
      "key": "createdSessionId",
      "value": ""
    },
    {
      "id": "87525d81-3ad6-4c51-9aa2-0bb49a0ee22c",
      "key": "machineNameSanity",
      "value": "sanity"
    },
    {
      "id": "26180a5c-6936-4fdc-8632-054e06a5758a",
      "key": "activeMachineName",
      "value": "sanity"
    },
    {
      "id": "0f8934b3-afff-4dd5-aeaf-dc992da6600a",
      "key": "machineNamePaper",
      "value": ""
    },
    {
      "id": "0469ea7f-0a8a-470b-8856-014a41e3866a",
      "key": "lastLoadError",
      "value": ""
    },
    {
      "id": "dc61d30f-5fdc-4d61-816d-5913904a9108",
      "key": "activeSessionId",
      "value": ""
    },
    {
      "id": "45128710-4b66-44fe-b93f-4d231eaa5c42",
      "key": "createdSessionIdSmall",
      "value": ""
    },
    {
      "id": "48f491ca-069a-40fa-9ac1-9a1c34306d29",
      "key": "deletedSessionId",
      "value": ""
    },
    {
      "id": "53816037-06d0-40a3-9503-a40fa10c65ad",
      "key": "historySessionId",
      "value": ""
    },
    {
      "id": "e8701984-7fb2-4366-af54-55bfec99404c",
      "key": "historyMachineName",
      "value": ""
    },
    {
      "id": "75ae0991-2c28-4b4a-ba03-eb69435b58e4",
      "key": "processInput",
      "value": "",
      "type": "default"
    },
    {
      "id": "37985ab3-0d02-4dcc-b1f2-8c2b8fa56b8d",
      "key": "lastProcessOutput",
      "value": ""
    },
    {
      "id": "ed27f105-f28b-4b79-9475-801cf0e09a7c",
      "key": "sanitySmallSessionId",
      "value": ""
    },
    {
      "id": "1c8c28df-71f5-49f2-b419-8dc03749b454",
      "key": "sanityPaperSessionId",
      "value": ""
    }
  ]
}
